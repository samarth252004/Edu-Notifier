{"version":3,"sources":["collections/semi-weak-map.ts"],"names":[],"mappings":";AAAA;;GAEG;AACH,IAAO,CAAC,WAAW,QAAQ,CAAC,CAAC;AAC7B;IAIC;QAHQ,UAAK,GAAc,EAAE,CAAC;QACtB,aAAQ,GAAG,IAAI,OAAO,EAAa,CAAC;IAI5C,CAAC;IAED,yBAAG,GAAH,UAAI,GAAY,EAAE,KAAS;QAC1B,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAA,CAAC;YAC9B,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACtB,CAAC;QACD,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;IAC/B,CAAC;IAED,2BAAK,GAAL;QACC,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;QAChB,IAAI,CAAC,QAAQ,GAAG,IAAI,OAAO,EAAa,CAAC;IAC1C,CAAC;IAED,4BAAM,GAAN,UAAO,GAAY;QAElB,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;YAC/B,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;QACzB,CAAC;IACF,CAAC;IAED,yBAAG,GAAH,UAAI,GAAY;QACf,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;IAC/B,CAAC;IAED,6BAAO,GAAP,UAAQ,CAAqB;QAC5B,IAAI,QAAQ,GAAG,EAAE,CAAC;QAClB,GAAG,CAAC,CAAY,UAAmB,EAAnB,KAAA,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,EAAnB,cAAmB,EAAnB,IAAmB,CAAC;YAA/B,IAAI,GAAG,SAAA;YACX,IAAI,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACpC,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;gBACZ,CAAC,CAAC,MAAM,CAAC,CAAC;YACX,CAAC;YAAC,IAAI,CAAC,CAAC;gBACP,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACpB,CAAC;SACD;QACD,CAAC,CAAC,IAAI,OAAN,CAAC,GAAM,IAAI,CAAC,KAAK,SAAK,QAAQ,EAAC,CAAC;IACjC,CAAC;IAEF,kBAAC;AAAD,CA5CA,AA4CC,IAAA;AA5CY,mBAAW,cA4CvB,CAAA","file":"collections/semi-weak-map.js","sourcesContent":["/**\r\n * Created by Greg on 14/10/2016.\r\n */\r\nimport _ = require('lodash');\r\nexport class SemiWeakMap<T> {\r\n\tprivate _keys : Object[] = [];\r\n\tprivate _weakMap = new WeakMap<Object, T>();\r\n\r\n\tconstructor() {\r\n\r\n\t}\r\n\r\n\tset(key : Object, value : T) {\r\n\t\tif (!this._keys.includes(key)){\r\n\t\t\tthis._keys.push(key);\r\n\t\t}\r\n\t\tthis._weakMap.set(key, value);\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis._keys = [];\r\n\t\tthis._weakMap = new WeakMap<Object, T>();\r\n\t}\r\n\r\n\tremove(key : Object) {\r\n\r\n\t\tif (this._weakMap.delete(key)) {\r\n\t\t\t_.pull(this._keys, key);\r\n\t\t}\r\n\t}\r\n\r\n\tget(key : Object) {\r\n\t\treturn this._weakMap.get(key);\r\n\t}\r\n\r\n\tforEach(f : (obj : T) => void) {\r\n\t\tlet toRemove = [];\r\n\t\tfor (let key of this._keys.slice(0)) {\r\n\t\t\tlet wValue = this._weakMap.get(key);\r\n\t\t\tif (wValue) {\r\n\t\t\t\tf(wValue);\r\n\t\t\t} else {\r\n\t\t\t\ttoRemove.push(key);\r\n\t\t\t}\r\n\t\t}\r\n\t\t_.pull(this._keys, ...toRemove);\r\n\t}\r\n\r\n}"],"sourceRoot":"/src"}